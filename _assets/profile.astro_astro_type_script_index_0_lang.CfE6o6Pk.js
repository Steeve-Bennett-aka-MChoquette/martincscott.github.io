import{s as o}from"./supabase.CIqLhAz5.js";import{s as l}from"./secure.DJnHEdPN.js";const d="fr",m=(l[d]||l.en).profile,y=(l[d]||l.en).secure;let i=null;async function p(){try{const{data:e,error:r}=await o.auth.getUser();if(r||!e?.user){window.location.href=`/${d}/auth/login`;return}i=e.user,E(i),await h(),document.getElementById("loading").classList.add("hidden"),document.getElementById("profile-content").classList.remove("hidden")}catch(e){console.error("Profile init error:",e),alert(`${y.authError}: ${e.message}`)}}function E(e){document.getElementById("user-email").textContent=e.email||"-";const r=e.app_metadata?.provider||"email",a=r.charAt(0).toUpperCase()+r.slice(1);document.getElementById("user-provider").textContent=a;const s=new Date(e.created_at);document.getElementById("user-created").textContent=s.toLocaleDateString(d);const t=e.last_sign_in_at?new Date(e.last_sign_in_at):null;document.getElementById("user-last-signin").textContent=t?t.toLocaleDateString(d)+" "+t.toLocaleTimeString(d):"-";const n=e.user_metadata?.avatar_url||"/images/default-avatar.png";document.getElementById("avatar-img").src=n}async function h(){const e=i.user_metadata||{};document.getElementById("display-name").value=e.display_name||e.full_name||"",document.getElementById("first-name").value=e.first_name||"",document.getElementById("last-name").value=e.last_name||"",document.getElementById("bio").value=e.bio||""}document.getElementById("profile-form").addEventListener("submit",async e=>{e.preventDefault();const r=document.getElementById("save-btn"),a=document.getElementById("save-text"),s=document.getElementById("saving-text"),t=document.getElementById("save-message");r.disabled=!0,a.classList.add("hidden"),s.classList.remove("hidden"),t.classList.add("hidden");try{const{error:n}=await o.auth.updateUser({data:{display_name:document.getElementById("display-name").value,first_name:document.getElementById("first-name").value,last_name:document.getElementById("last-name").value,bio:document.getElementById("bio").value}});if(n)throw n;t.textContent=m.saved,t.classList.remove("hidden","error"),t.classList.add("success")}catch(n){t.textContent=`${m.saveError}: ${n.message}`,t.classList.remove("hidden","success"),t.classList.add("error")}finally{r.disabled=!1,a.classList.remove("hidden"),s.classList.add("hidden")}});document.getElementById("change-avatar").addEventListener("click",()=>{document.getElementById("avatar-input").click()});document.getElementById("avatar-input").addEventListener("change",async e=>{const a=e.target.files?.[0];if(!a)return;const s=new FileReader;s.onload=t=>{const n=document.getElementById("avatar-img");n.src=t.target?.result},s.readAsDataURL(a);try{const t=a.name.split(".").pop(),u=`${i.id}-${Date.now()}.${t}`,{error:g}=await o.storage.from("avatars").upload(u,a,{upsert:!0});if(g)throw g;const{data:f}=o.storage.from("avatars").getPublicUrl(u),c=f.publicUrl,{error:v}=await o.auth.updateUser({data:{avatar_url:c}});if(v)throw v;await o.auth.refreshSession(),document.getElementById("avatar-img").src=c,console.log("Avatar uploaded successfully:",c)}catch(t){console.error("Avatar upload error:",t),alert(`${m.saveError}: ${t.message}`)}});document.getElementById("logout-button").addEventListener("click",async()=>{try{const{error:e}=await o.auth.signOut();if(e)throw e;window.location.href=`/${d}/auth/login`}catch(e){alert(`${y.logoutError}: ${e.message}`)}});p();
