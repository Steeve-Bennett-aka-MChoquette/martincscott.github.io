import{s as l}from"./supabase.CvWEuyUO.js";import{s as d}from"./secure.DJnHEdPN.js";const o="fr",c=(d[o]||d.en).profile,m=(d[o]||d.en).secure;let i=null;async function u(){try{const{data:e,error:a}=await l.auth.getUser();if(a||!e?.user){window.location.href=`/${o}/auth/login`;return}i=e.user,g(i),await v(),document.getElementById("loading").classList.add("hidden"),document.getElementById("profile-content").classList.remove("hidden")}catch(e){console.error("Profile init error:",e),alert(`${m.authError}: ${e.message}`)}}function g(e){document.getElementById("user-email").textContent=e.email||"-";const a=e.app_metadata?.provider||"email",s=a.charAt(0).toUpperCase()+a.slice(1);document.getElementById("user-provider").textContent=s;const r=new Date(e.created_at);document.getElementById("user-created").textContent=r.toLocaleDateString(o);const t=e.last_sign_in_at?new Date(e.last_sign_in_at):null;document.getElementById("user-last-signin").textContent=t?t.toLocaleDateString(o)+" "+t.toLocaleTimeString(o):"-";const n=e.user_metadata?.avatar_url||"/images/default-avatar.png";document.getElementById("avatar-img").src=n}async function v(){const e=i.user_metadata||{};document.getElementById("display-name").value=e.display_name||e.full_name||"",document.getElementById("first-name").value=e.first_name||"",document.getElementById("last-name").value=e.last_name||"",document.getElementById("bio").value=e.bio||""}document.getElementById("profile-form").addEventListener("submit",async e=>{e.preventDefault();const a=document.getElementById("save-btn"),s=document.getElementById("save-text"),r=document.getElementById("saving-text"),t=document.getElementById("save-message");a.disabled=!0,s.classList.add("hidden"),r.classList.remove("hidden"),t.classList.add("hidden");try{const{error:n}=await l.auth.updateUser({data:{display_name:document.getElementById("display-name").value,first_name:document.getElementById("first-name").value,last_name:document.getElementById("last-name").value,bio:document.getElementById("bio").value}});if(n)throw n;t.textContent=c.saved,t.classList.remove("hidden","error"),t.classList.add("success")}catch(n){t.textContent=`${c.saveError}: ${n.message}`,t.classList.remove("hidden","success"),t.classList.add("error")}finally{a.disabled=!1,s.classList.remove("hidden"),r.classList.add("hidden")}});document.getElementById("change-avatar").addEventListener("click",()=>{document.getElementById("avatar-input").click()});document.getElementById("avatar-input").addEventListener("change",async e=>{const s=e.target.files?.[0];if(!s)return;const r=new FileReader;r.onload=t=>{const n=document.getElementById("avatar-img");n.src=t.target?.result},r.readAsDataURL(s)});document.getElementById("logout-button").addEventListener("click",async()=>{try{const{error:e}=await l.auth.signOut();if(e)throw e;window.location.href=`/${o}/auth/login`}catch(e){alert(`${m.logoutError}: ${e.message}`)}});u();
