import{s as l}from"./supabase.ByIZrgG1.js";import{s as i}from"./secure.DJnHEdPN.js";const o="fr",u=(i[o]||i.en).profile,v=(i[o]||i.en).secure;let c=null;async function y(){try{const{data:e,error:r}=await l.auth.getUser();if(r||!e?.user){window.location.href=`/${o}/auth/login`;return}c=e.user,await f(c),await p(),document.getElementById("loading").classList.add("hidden"),document.getElementById("profile-content").classList.remove("hidden")}catch(e){console.error("Profile init error:",e),alert(`${v.authError}: ${e.message}`)}}async function f(e){document.getElementById("user-email").textContent=e.email||"-";const r=e.app_metadata?.provider||"email",n=r.charAt(0).toUpperCase()+r.slice(1);document.getElementById("user-provider").textContent=n;const s=new Date(e.created_at);document.getElementById("user-created").textContent=s.toLocaleDateString(o);const t=e.last_sign_in_at?new Date(e.last_sign_in_at):null;document.getElementById("user-last-signin").textContent=t?t.toLocaleDateString(o)+" "+t.toLocaleTimeString(o):"-";const a=document.getElementById("avatar-img"),{data:d}=await l.storage.from("avatars").list("",{search:e.id});if(d&&d.length>0){const{data:m}=l.storage.from("avatars").getPublicUrl(d[0].name);a.src=m.publicUrl+"?t="+Date.now()}else a.src=e.user_metadata?.avatar_url||"/images/default-avatar.png"}async function p(){const e=c.user_metadata||{};document.getElementById("display-name").value=e.display_name||e.full_name||"",document.getElementById("first-name").value=e.first_name||"",document.getElementById("last-name").value=e.last_name||"",document.getElementById("bio").value=e.bio||""}document.getElementById("profile-form").addEventListener("submit",async e=>{e.preventDefault();const r=document.getElementById("save-btn"),n=document.getElementById("save-text"),s=document.getElementById("saving-text"),t=document.getElementById("save-message");r.disabled=!0,n.classList.add("hidden"),s.classList.remove("hidden"),t.classList.add("hidden");try{const{error:a}=await l.auth.updateUser({data:{display_name:document.getElementById("display-name").value,first_name:document.getElementById("first-name").value,last_name:document.getElementById("last-name").value,bio:document.getElementById("bio").value}});if(a)throw a;t.textContent=u.saved,t.classList.remove("hidden","error"),t.classList.add("success")}catch(a){t.textContent=`${u.saveError}: ${a.message}`,t.classList.remove("hidden","success"),t.classList.add("error")}finally{r.disabled=!1,n.classList.remove("hidden"),s.classList.add("hidden")}});document.getElementById("change-avatar").addEventListener("click",()=>{document.getElementById("avatar-input").click()});document.getElementById("avatar-input").addEventListener("change",async e=>{const n=e.target.files?.[0];if(!n)return;const s=new FileReader;s.onload=t=>{const a=document.getElementById("avatar-img");a.src=t.target?.result},s.readAsDataURL(n);try{const t=n.name.split(".").pop(),a=`${c.id}.${t}`,{error:d}=await l.storage.from("avatars").upload(a,n,{upsert:!0});if(d)throw d;const{data:m}=l.storage.from("avatars").getPublicUrl(a),g=m.publicUrl+"?t="+Date.now();document.getElementById("avatar-img").src=g,console.log("Avatar uploaded successfully:",g)}catch(t){console.error("Avatar upload error:",t),alert(`${u.saveError}: ${t.message}`)}});document.getElementById("logout-button").addEventListener("click",async()=>{try{const{error:e}=await l.auth.signOut();if(e)throw e;window.location.href=`/${o}/auth/login`}catch(e){alert(`${v.logoutError}: ${e.message}`)}});y();
