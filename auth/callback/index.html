<!DOCTYPE html><html data-astro-cid-qbporkgn> <head><meta charset="UTF-8"><title>Authentication Callback</title><link rel="stylesheet" href="/_assets/about.CZ3QQt_3.css">
<style>body{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#f9fafb;color:#1f2937}.container[data-astro-cid-qbporkgn]{text-align:center;padding:2rem;border-radius:.5rem;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f;background-color:#fff;max-width:24rem}.dark-mode[data-astro-cid-qbporkgn] .container[data-astro-cid-qbporkgn]{background-color:#1f2937;color:#f9fafb}h1[data-astro-cid-qbporkgn]{font-size:1.5rem;margin-bottom:1rem}p[data-astro-cid-qbporkgn]{margin-bottom:1rem}.spinner[data-astro-cid-qbporkgn]{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;border-radius:50%;border-left-color:#3b82f6;animation:spin 1s linear infinite;margin:1rem auto}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.dark-mode[data-astro-cid-qbporkgn] .spinner[data-astro-cid-qbporkgn]{border-color:#ffffff1a;border-left-color:#3b82f6}
</style></head> <body data-astro-cid-qbporkgn> <div class="container" data-astro-cid-qbporkgn> <h1 data-astro-cid-qbporkgn>Authentication</h1> <div class="spinner" data-astro-cid-qbporkgn></div> <p id="message" data-astro-cid-qbporkgn>Processing your authentication...</p> </div> <script>(function(){const supabaseUrl = "https://supabase.martincscott.com";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwiaWF0IjoxNzAwMDAwMDAwLCJleHAiOjIwMDAwMDAwMDB9.GADmD1dISXfsTNCNndThfDar4IrgsD0DJFeJ2WdQ3pQ";

    // Check if dark mode is enabled
    if (localStorage.getItem('appTheme') === 'dark' ||
        (!('appTheme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.body.classList.add('dark-mode');
    }

    // Initialize Supabase client when the page loads
    document.addEventListener('DOMContentLoaded', async () => {
      const messageElement = document.getElementById('message');
      const locale = localStorage.getItem('auth_locale') || 'fr';

      try {
        if (!supabaseUrl || !supabaseAnonKey) {
          throw new Error('Supabase configuration is missing');
        }

        // Dynamically import the Supabase client
        const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');

        // Initialize the client
        const supabase = createClient(supabaseUrl, supabaseAnonKey);

        // Check for hash fragment (OAuth or email confirmation)
        const hashParams = new URLSearchParams(window.location.hash.substring(1));
        const queryParams = new URLSearchParams(window.location.search);

        // Handle error in URL
        const error = hashParams.get('error') || queryParams.get('error');
        if (error) {
          const errorDescription = hashParams.get('error_description') || queryParams.get('error_description') || error;
          throw new Error(errorDescription);
        }

        // Handle code exchange (PKCE flow)
        const code = queryParams.get('code');
        if (code) {
          messageElement.textContent = 'Finalisation de l\'authentification...';
          const { error: exchangeError } = await supabase.auth.exchangeCodeForSession(code);
          if (exchangeError) throw exchangeError;
        }

        // Handle access token in hash (implicit flow / email confirmation)
        const accessToken = hashParams.get('access_token');
        if (accessToken) {
          messageElement.textContent = 'Vérification du token...';
          // Token is automatically handled by Supabase client
        }

        // Wait a moment for session to be established
        await new Promise(resolve => setTimeout(resolve, 500));

        // Check session
        const { data: { session }, error: sessionError } = await supabase.auth.getSession();

        if (sessionError) throw sessionError;

        if (session) {
          messageElement.textContent = 'Authentification réussie! Redirection...';
          window.location.href = `/${locale}/secure`;
        } else {
          messageElement.textContent = 'Session non trouvée. Redirection...';
          setTimeout(() => {
            window.location.href = `/${locale}/auth/login`;
          }, 2000);
        }
      } catch (error) {
        console.error('Auth callback error:', error);
        messageElement.textContent = `Erreur: ${error.message}. Redirection...`;
        setTimeout(() => {
          window.location.href = `/${locale}/auth/login`;
        }, 3000);
      }
    });
  })();</script> </body> </html>