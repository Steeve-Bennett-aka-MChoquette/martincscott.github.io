<!DOCTYPE html><html data-astro-cid-qbporkgn> <head><meta charset="UTF-8"><title>Authentication Callback</title><link rel="stylesheet" href="/_assets/about.DJqhl5Ab.css">
<style>body{font-family:system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#f9fafb;color:#1f2937}.container[data-astro-cid-qbporkgn]{text-align:center;padding:2rem;border-radius:.5rem;box-shadow:0 4px 6px -1px #0000001a,0 2px 4px -1px #0000000f;background-color:#fff;max-width:24rem}.dark-mode[data-astro-cid-qbporkgn] .container[data-astro-cid-qbporkgn]{background-color:#1f2937;color:#f9fafb}h1[data-astro-cid-qbporkgn]{font-size:1.5rem;margin-bottom:1rem}p[data-astro-cid-qbporkgn]{margin-bottom:1rem}.spinner[data-astro-cid-qbporkgn]{border:4px solid rgba(0,0,0,.1);width:36px;height:36px;border-radius:50%;border-left-color:#3b82f6;animation:spin 1s linear infinite;margin:1rem auto}@keyframes spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.dark-mode[data-astro-cid-qbporkgn] .spinner[data-astro-cid-qbporkgn]{border-color:#ffffff1a;border-left-color:#3b82f6}
</style></head> <body data-astro-cid-qbporkgn> <div class="container" data-astro-cid-qbporkgn> <h1 data-astro-cid-qbporkgn>Authentication</h1> <div class="spinner" data-astro-cid-qbporkgn></div> <p id="message" data-astro-cid-qbporkgn>Processing your authentication...</p> </div> <script>(function(){const supabaseUrl = "https://supabase.martincscott.com";
const supabaseAnonKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyAgCiAgICAicm9sZSI6ICJhbm9uIiwKICAgICJpc3MiOiAic3VwYWJhc2UtZGVtbyIsCiAgICAiaWF0IjogMTY0MTc2OTIwMCwKICAgICJleHAiOiAxNzk5NTM1NjAwCn0.dc_X5iR_VP_qT0zsiyj_I_OZ2T9FtRU2BBNWN8Bu4GE";

    // Check if dark mode is enabled
    if (localStorage.getItem('appTheme') === 'dark' || 
        (!('appTheme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
      document.body.classList.add('dark-mode');
    }
    
    // Process the authentication and redirect
    async function handleAuthCallback() {
      const messageElement = document.getElementById('message');
      
      try {
        // Get stored language preference, default to 'fr'
        const locale = localStorage.getItem('auth_locale') || 'fr';
        
        // Get auth state
        const { data, error } = await window.supabaseClient.auth.getSession();
        
        if (error) throw error;
        
        if (data?.session) {
          // Authentication successful, redirect to secure area
          messageElement.textContent = 'Authentication successful! Redirecting...';
          window.location.href = `/${locale}/secure`;
        } else {
          // No session found, redirect to login
          messageElement.textContent = 'No session found. Redirecting to login...';
          setTimeout(() => {
            window.location.href = `/${locale}/auth/login`;
          }, 2000);
        }
      } catch (error) {
        console.error('Auth callback error:', error);
        messageElement.textContent = 'Authentication error. Redirecting to login...';
        
        // Redirect to login after a delay
        setTimeout(() => {
          const locale = localStorage.getItem('auth_locale') || 'fr';
          window.location.href = `/${locale}/auth/login`;
        }, 3000);
      }
    }
    
    // Initialize Supabase client when the page loads
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Log the environment variables (without exposing the full key)
        console.log('Supabase URL:', supabaseUrl);
        console.log('Supabase Key available:', !!supabaseAnonKey);
        
        if (!supabaseUrl || !supabaseAnonKey) {
          throw new Error('Supabase configuration is missing');
        }
        
        // Dynamically import the Supabase client
        const { createClient } = await import('https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm');
        console.log('Supabase client imported successfully');
        
        // Initialize the client with environment variables passed from the server
        const supabase = createClient(
          supabaseUrl,
          supabaseAnonKey
        );
        console.log('Supabase client initialized successfully');
        
        // Make supabase available to the handleAuthCallback function
        window.supabaseClient = supabase;
        
        // Handle the authentication
        handleAuthCallback();
      } catch (error) {
        console.error('Failed to initialize Supabase client:', error);
        document.getElementById('message').textContent =
          'Failed to initialize authentication client. Please try again.';
          
        // Add more detailed error information to the console
        if (error instanceof Error) {
          console.error('Error name:', error.name);
          console.error('Error message:', error.message);
          console.error('Error stack:', error.stack);
        }
      }
    });
  })();</script> </body> </html>